cmake_minimum_required(VERSION 3.0)
set(CMAKE_CXX_STANDARD 17)

project(Coursework C CXX)

# location of source code files
include_directories(include)

# tell cmake where to put the executables that it creates
file(MAKE_DIRECTORY bin)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY bin)

# where to put the object files it creates
file(MAKE_DIRECTORY lib)
SET(LIBRARY_OUTPUT_PATH lib)

# autogenerate code from the DBC file
file(MAKE_DIRECTORY src_autogen)
add_custom_command(
    OUTPUT src_autogen/data.h src_autogen/data.c
    COMMAND python3 -m cantools generate_c_source data.dbc -o src_autogen
    MAIN_DEPENDENCY data.dbc
    COMMENT "Autogenerate code from DBC file"
)

# create shared library of the autogenerated code from the DBC file
add_library(data SHARED src_autogen/data.c src_autogen/data.h)
target_include_directories(data PUBLIC src_autogen)

add_executable(src_code src/src_code.cpp)
target_link_libraries(src_code PRIVATE data)
